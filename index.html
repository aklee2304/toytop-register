<script>
  const tg = window.Telegram.WebApp;
  tg.expand();

  const form = document.getElementById("form");

  form.addEventListener("submit", (e) => {
    e.preventDefault();

    const formData = Object.fromEntries(new FormData(form).entries());

    const telegramId = tg?.initDataUnsafe?.user?.id || "";
    if (!telegramId) {
      alert("Не удалось получить Telegram ID. Открой форму через бота.");
      return;
    }

    const data = {
      telegram_id: telegramId,
      name: formData.name,
      username: formData.username,
      category: formData.category,
      city: formData.city,
      about: formData.about,
      price: formData.price
    };

    fetch("https://script.google.com/macros/s/AKfycbwa4kfBDpnm4puzENaUrcZhqbcPy7QBR-c98dm_c1e5gcEzhekkTGlPukNzeyXAovkB/exec", {
      method: "POST",
      mode: "no-cors",
      body: JSON.stringify({ contents: data }),
      headers: {
        "Content-Type": "text/plain;charset=utf-8"
      }
    })
    .then(() => {
      alert("Анкета отправлена!");
      tg.close();
    })
    .catch((err) => {
      alert("Ошибка при отправке.");
      console.error(err);
    });
  });
</script>
