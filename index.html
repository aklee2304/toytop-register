<script>
  const tg = window.Telegram.WebApp;
  tg.expand();

  const form = document.getElementById("form");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const formData = Object.fromEntries(new FormData(form).entries());

    // Telegram ID
    const telegramId = tg?.initDataUnsafe?.user?.id || "";
    if (!telegramId) {
      alert("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å Telegram ID. –û—Ç–∫—Ä–æ–π —Ñ–æ—Ä–º—É —á–µ—Ä–µ–∑ –±–æ—Ç–∞.");
      return;
    }

    const data = {
      telegram_id: telegramId,
      name: formData.name,
      username: formData.username,
      category: formData.category,
      city: formData.city,
      about: formData.about,
      price: formData.price
    };

    // üîÑ –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ no-cors
    fetch("https://script.google.com/macros/s/AKfycbwa4kfBDpnm4puzENaUrcZhqbcPy7QBR-c98dm_c1e5gcEzhekkTGlPukNzeyXAovkB/exec", {
      method: "POST",
      mode: "no-cors",
      body: JSON.stringify({ contents: data }),
      headers: {
        "Content-Type": "text/plain;charset=utf-8"
      }
    })
    .then(() => {
      alert("–ê–Ω–∫–µ—Ç–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!");
      tg.close();
    })
    .catch((err) => {
      alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ.");
      console.error(err);
    });
  });
</script>
